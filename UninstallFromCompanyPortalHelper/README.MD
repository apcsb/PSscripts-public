# UninstallFromCompanyPortalHelper.ps1
USE AS IS. I BEAR NO RESPONSIBILITY - IT IS ALL YOUR PROBLEM.

This script helps review and enable the newly released Intune feature "Allow manual uninstallation of app via Company Portal".

This script can do the following:
* **Export** (Review): connects to Intune and exports into two CSV files all apps that do not have an uninstall command, and all apps that do have an uninstall command. You can reviews these lists and take actions.   
* **Update** (Import): imports the data from Intune or a  CSV file (which can be generated by the review mode), updates the uninstall command based on the file contents and enables the manual uninstall switch.

The script was developed for Graph PowerShell SDK 1.0, but might work with 2.0 as well (it uses Graps Beta endpoints).

## Parameters
### -Export
Indicates that the data must be saved to CSV files in the current directory.

### -UpdateFromFile
Specifies the path to the CSV file containing the list of apps to enable uninstall for. 
* Must contain ID. 
* Other parameters are DisplayName (then you will see names instead of IDs) and UninstallCommandLine (will overwrite if present and differs from the one in Intune). 
* There are no sanity checks on the command line!
* The file generated by this script will do.
* **Cannot be used with -Export**

### -UpdateFromIntune
Indicates that you just want to go through all apps with the uninstall line and set the **allowAvailableUninstall** to **True**.

**Can be used with Export**

## OUTPUTS
Two CSV files in the current directory, if Export is specified.

Lots of text output and Verbose mode.

## EXAMPLES
    .\Intune-UninstallCommandCheck.ps1 -Export

Connects to Intune and exports apps with and without an uninstall command to two CSV files in the current directory.

    .\Intune-UninstallCommandCheck.ps1 -UpdateFromIntune

Uses the data from Intune to enable the manual uninstall switch on all apps with an uninstall command. Make sure your uninstall commands are correct!

    .\Intune-UninstallCommandCheck.ps1 -UpdateFromFile .\apps_with_uninstall.csv

Imports the CSV file (ex. generated by the review mode), updates the uninstall command (if present in CSV) and enables the manual uninstall switch.

    .\Intune-UninstallCommandCheck.ps1 -UpdateFromIntune -Export

Does the same as -UpdateFromIntune, but you also get the CSV files.

Enjoy!